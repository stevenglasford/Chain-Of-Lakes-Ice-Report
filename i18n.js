// Minimal translation dictionary. Add/adjust phrases anytime.
const I18N = {
  en: {
    t_title: "Minneapolis Frozen Lakes Report",
    t_subtitle: "Live from Google Sheets",
    t_units: "Units",
    t_language: "Language",
    t_refresh: "Refresh",
    t_map: "Map",
    t_latest: "Latest per lake",
    t_latest_hint: "Most recent entry for each lake",
    t_table: "Data",
    t_filters: "Filters",
    t_lake: "Lake",
    t_search: "Search",
    t_source: "Source:",
    th_date: "Date",
    th_lake: "Lake",
    th_thickness: "Thickness",
    th_info: "Info",
    th_coords: "Coordinates",
    status_loading: "Loading…",
    status_loaded: (n) => `Loaded ${n} rows`,
    status_error: "Could not load data (check sheet publish settings).",
    no_coords: "No coordinates",
    no_thickness: "No thickness",
    t_date_range: "Date range",
    t_from: "From",
    t_to: "To",
    t_search_ph: "Info / lake / date…",
    t_all: "All",
    t_range_all: "All",
    t_range_7d: "Last 7 days",
    t_range_14d: "Last 14 days",
    t_range_30d: "Last 30 days",
    t_range_season: "This season",
    t_range_custom: "Custom",
  },

  fr: {
    t_title: "Rapport sur la glace",
    t_subtitle: "En direct depuis Google Sheets",
    t_units: "Unités",
    t_language: "Langue",
    t_refresh: "Actualiser",
    t_map: "Carte",
    t_latest: "Dernières mesures par lac",
    t_latest_hint: "Entrée la plus récente pour chaque lac",
    t_table: "Données",
    t_filters: "Filtres",
    t_lake: "Lac",
    t_search: "Rechercher",
    t_source: "Source :",
    th_date: "Date",
    th_lake: "Lac",
    th_thickness: "Épaisseur",
    th_info: "Info",
    th_coords: "Coordonnées",
    status_loading: "Chargement…",
    status_loaded: (n) => `${n} lignes chargées`,
    status_error: "Impossible de charger (vérifie la publication du sheet).",
    no_coords: "Pas de coordonnées",
    no_thickness: "Pas d’épaisseur",
    t_date_range: "Plage de dates",
    t_from: "Du",
    t_to: "Au",
    t_search_ph: "Info / lac / date…",
    t_all: "Tous",
    t_range_all: "Tous",
    t_range_7d: "7 derniers jours",
    t_range_14d: "14 derniers jours",
    t_range_30d: "30 derniers jours",
    t_range_season: "Cette saison",
    t_range_custom: "Personnalisé",
  },

  es: {
    t_title: "Informe de hielo",
    t_subtitle: "En vivo desde Google Sheets",
    t_units: "Unidades",
    t_language: "Idioma",
    t_refresh: "Actualizar",
    t_map: "Mapa",
    t_latest: "Último por lago",
    t_latest_hint: "Entrada más reciente por lago",
    t_table: "Datos",
    t_filters: "Filtros",
    t_lake: "Lago",
    t_search: "Buscar",
    t_search_ph: "Info / lago / fecha…",
    t_source: "Fuente:",
    th_date: "Fecha",
    th_lake: "Lago",
    th_thickness: "Espesor",
    th_info: "Info",
    th_coords: "Coordenadas",
    status_loading: "Cargando…",
    status_loaded: (n) => `${n} filas cargadas`,
    status_error: "No se pudo cargar (revisa publicación del sheet).",
    no_coords: "Sin coordenadas",
    no_thickness: "Sin espesor",
    t_date_range: "Rango de fechas",
    t_from: "Desde",
    t_to: "Hasta",
    t_search_ph: "Info / lago / fecha…",
    t_all: "Todos",
    t_range_all: "Todos",
    t_range_7d: "Últimos 7 días",
    t_range_14d: "Últimos 14 días",
    t_range_30d: "Últimos 30 días",
    t_range_season: "Esta temporada",
    t_range_custom: "Personalizado",
  },

  // These are simple placeholders—feel free to replace with better translations.
  hmn: {
    t_title: "Daim Ntawv Tshaj Qhia Dej Khov",
    t_subtitle: "Nyob ncaj qha ntawm Google Sheets",
    t_units: "Chav",
    t_language: "Lus",
    t_refresh: "Rov tshiab",
    t_map: "Daim duab qhia",
    t_latest: "Tshiab tshaj rau txhua lub pas dej",
    t_latest_hint: "Cov ntaub ntawv tshiab tshaj rau txhua lub pas dej",
    t_table: "Daim ntawv",
    t_filters: "Lim",
    t_lake: "Pas dej",
    t_search: "Nrhiav",
    t_search_ph: "Info / pas dej / hnub…",
    t_source: "Chaw los:",
    th_date: "Hnub",
    th_lake: "Pas dej",
    th_thickness: "Tuab",
    th_info: "Info",
    th_coords: "Koordinates",
    status_loading: "Tab tom thauj…",
    status_loaded: (n) => `Thauj tau ${n} kab`,
    status_error: "Thauj tsis tau (xyuas sheet publish).",
    no_coords: "Tsis muaj koordinates",
    no_thickness: "Tsis muaj tuab",
    t_date_range: "Qhov ntau hnub tim",
    t_from: "Pib",
    t_to: "Xaus",
    t_search_ph: "Info / pas dej / hnub…",
    t_all: "Txhua yam",
    t_range_all: "Txhua yam",
    t_range_7d: "7 hnub dhau los",
    t_range_14d: "14 hnub dhau los",
    t_range_30d: "30 hnub dhau los",
    t_range_season: "Lub caij no",
    t_range_custom: "Kho raws li xav",
  },

  so: {
    t_title: "Warbixinta Barafka",
    t_subtitle: "Si toos ah uga imanaya Google Sheets",
    t_units: "Unugyo",
    t_language: "Luuqad",
    t_refresh: "Cusboonaysii",
    t_map: "Khariidad",
    t_latest: "Ugu dambayn halkii haro",
    t_latest_hint: "Gelinta ugu dambeysa haro kasta",
    t_table: "Xog",
    t_filters: "Shaandheyn",
    t_lake: "Haro",
    t_search: "Raadi",
    t_search_ph: "Info / haro / taariikh…",
    t_source: "Isha:",
    th_date: "Taariikh",
    th_lake: "Haro",
    th_thickness: "Dhumuc",
    th_info: "Info",
    th_coords: "Isuduwaha",
    status_loading: "Wuu soo dhacayaa…",
    status_loaded: (n) => `${n} saf ayaa la soo dejiyey`,
    status_error: "Lama soo dejin karo (hubi publish-ka sheet).",
    no_coords: "Isuduwaha ma jiro",
    no_thickness: "Dhumuc ma jiro",
    t_date_range: "Xadka taariikhaha",
    t_from: "Laga bilaabo",
    t_to: "Ilaa",
    t_search_ph: "Info / haro / taariikh…",
    t_all: "Dhammaan",
    t_range_all: "Dhammaan",
    t_range_7d: "7 maalmood ee u dambeeyay",
    t_range_14d: "14 maalmood ee u dambeeyay",
    t_range_30d: "30 maalmood ee u dambeeyay",
    t_range_season: "Xilligan",
    t_range_custom: "Gaar ah",
  },

  ar: {
    t_title: "تقرير الجليد",
    t_subtitle: "مباشر من Google Sheets",
    t_units: "الوحدات",
    t_language: "اللغة",
    t_refresh: "تحديث",
    t_map: "الخريطة",
    t_latest: "آخر قراءة لكل بحيرة",
    t_latest_hint: "أحدث إدخال لكل بحيرة",
    t_table: "البيانات",
    t_filters: "عوامل التصفية",
    t_lake: "البحيرة",
    t_search: "بحث",
    t_source: "المصدر:",
    th_date: "التاريخ",
    th_lake: "البحيرة",
    th_thickness: "السماكة",
    th_info: "معلومات",
    th_coords: "الإحداثيات",
    status_loading: "جارٍ التحميل…",
    status_loaded: (n) => `تم تحميل ${n} صف`,
    status_error: "تعذّر التحميل (تحقق من نشر الجدول).",
    no_coords: "لا توجد إحداثيات",
    no_thickness: "لا توجد سماكة",
    t_date_range: "نطاق التاريخ",
    t_from: "من",
    t_to: "إلى",
    t_search_ph: "معلومات / بحيرة / تاريخ…",
    t_all: "الكل",
    t_range_all: "الكل",
    t_range_7d: "آخر ٧ أيام",
    t_range_14d: "آخر ١٤ يومًا",
    t_range_30d: "آخر ٣٠ يومًا",
    t_range_season: "هذا الموسم",
    t_range_custom: "مخصص",
  },

  aii: {
    t_title: "ܕܘܟܬܐ ܕܬܪܝܨܘܬܐ ܕܓܠܝܕܐ",
    t_subtitle: "ܡܢ Google Sheets ܒܚܝܐ",
    t_units: "ܡܕܝܢܘܬܐ",
    t_language: "ܠܫܢܐ",
    t_refresh: "ܚܕܬ",
    t_map: "ܟܪܛܐ",
    t_latest: "ܚܕܬܐ ܠܟܠ ܝܡܐ",
    t_latest_hint: "ܟܬܒܐ ܚܕܬܐ ܠܟܠ ܝܡܐ",
    t_table: "ܕܝܬܐ",
    t_filters: "ܡܣܢܢܐ",
    t_lake: "ܝܡܐ",
    t_search: "ܒܨܝ",
    t_source: "ܡܒܘܥܐ:",
    th_date: "ܝܘܡܐ",
    th_lake: "ܝܡܐ",
    th_thickness: "ܥܒܝܘܬܐ",
    th_info: "ܡܘܕܥܢܘܬܐ",
    th_coords: "ܬܘܒܥܐ",
    status_loading: "ܒܥܒܕܐ ܕܛܥܢܐ…",
    status_loaded: (n) => `ܛܥܢ ${n} ܣܛܪܐ`,
    status_error: "ܠܐ ܡܨܐ ܠܛܥܢ (ܚܙܝ publish).",
    no_coords: "ܠܝܬ ܬܘܒܥܐ",
    no_thickness: "ܠܝܬ ܥܒܝܘܬܐ",
    t_date_range: "ܬܚܘܡܐ ܕܝܘܡܬ̈ܐ",
    t_from: "ܡܢ",
    t_to: "ܥܕܡܐ ܠ",
    t_search_ph: "ܡܘܕܥܢܘܬܐ / ܝܡܐ / ܝܘܡܐ…",
    t_all: "ܟܠܗܘܢ",
    t_range_all: "ܟܠܗܘܢ",
    t_range_7d: "ܚܪ̈ܝܐ 7 ܝܘܡ̈ܐ",
    t_range_14d: "ܚܪ̈ܝܐ 14 ܝܘܡ̈ܐ",
    t_range_30d: "ܚܪ̈ܝܐ 30 ܝܘܡ̈ܐ",
    t_range_season: "ܗܢܐ ܥܕܢܐ",
    t_range_custom: "ܦܪܨܘܦܝܐ",
  },
    fi: {
    t_title: "Jääraportti",
    t_subtitle: "Suoraan Google Sheetsistä",
    t_units: "Yksiköt",
    t_language: "Kieli",
    t_refresh: "Päivitä",
    t_map: "Kartta",
    t_latest: "Uusin per järvi",
    t_latest_hint: "Uusin merkintä jokaiselle järvelle",
    t_table: "Data",
    t_filters: "Suodattimet",
    t_lake: "Järvi",
    t_search: "Haku",
    t_search_ph: "Info / järvi / päivämäärä…",
    t_source: "Lähde:",
    th_date: "Päivämäärä",
    th_lake: "Järvi",
    th_thickness: "Paksuus",
    th_info: "Info",
    th_coords: "Koordinaatit",
    status_loading: "Ladataan…",
    status_loaded: (n) => `Ladattu ${n} riviä`,
    status_error: "Tietojen lataus epäonnistui (tarkista sheetin julkaisuasetukset).",
    no_coords: "Ei koordinaatteja",
    no_thickness: "Ei paksuutta",
    t_date_range: "Päivämääräväli",
    t_from: "Alkaen",
    t_to: "Asti",
    t_search_ph: "Info / järvi / päivämäärä…",
    t_all: "Kaikki",
    t_range_all: "Kaikki",
    t_range_7d: "Viimeiset 7 päivää",
    t_range_14d: "Viimeiset 14 päivää",
    t_range_30d: "Viimeiset 30 päivää",
    t_range_season: "Tämä kausi",
    t_range_custom: "Mukautettu",
  }
};

function t(lang, key, arg) {
  const dict = I18N[lang] || I18N.en;
  const val = dict[key] ?? I18N.en[key] ?? key;
  return (typeof val === "function") ? val(arg) : val;
}

function applyTranslations(lang) {
  document.documentElement.lang = lang;
  // Arabic is RTL
  document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";

  const keys = Object.keys(I18N.en);
  for (const k of keys) {
    const el = document.getElementById(k);
    if (el && typeof I18N.en[k] !== "function") el.textContent = t(lang, k);
  }

  // Inputs / placeholders (not handled by textContent loop)
  const searchInput = document.getElementById("searchInput");
  if (searchInput) {
    // Fallback to English placeholder if the language doesn't define one.
    searchInput.placeholder = t(lang, "t_search_ph");
  }
    // Translate date-range select options by value
  const rangeSelect = document.getElementById("mapRangeSelect");
  if (rangeSelect) {
    const labelByValue = {
      all: t(lang, "t_range_all"),
      "7d": t(lang, "t_range_7d"),
      "14d": t(lang, "t_range_14d"),
      "30d": t(lang, "t_range_30d"),
      season: t(lang, "t_range_season"),
      custom: t(lang, "t_range_custom"),
    };

    for (const opt of rangeSelect.options) {
      const v = opt.value;
      if (labelByValue[v]) opt.textContent = labelByValue[v];
    }
  }

  // Translate the "All" option inside the lake filter (value="")
  const lakeFilter = document.getElementById("lakeFilter");
  if (lakeFilter) {
    const allOpt = lakeFilter.querySelector('option[value=""]');
    if (allOpt) allOpt.textContent = t(lang, "t_all");
  }
}